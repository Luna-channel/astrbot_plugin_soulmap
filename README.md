# 用户画像 (SoulMap)

AI驱动的用户画像收集系统，在聊天中自动提取用户信息，并在对话中自然运用。

## 功能特点

- **无感收集**：AI在聊天中自然提取用户信息，无需用户手动填写
- **模板约束**：只能记录预定义字段，AI无法随意新增字段
- **用户可控**：用户可随时查看/删除自己的数据
- **隐私保护**：可配置禁止在群聊中查看画像，保护用户隐私
- **备注追加**：备注字段自动追加，保留最近N条
- **会话隔离**：可选按窗口独立存储或全局共享

## 默认画像字段

| 字段 | 说明 |
|------|------|
| 对用户的称呼 | 用户希望被叫的名字/昵称 |
| 性别 | 性别 |
| 年龄 | 年龄 |
| 所在地 | 所在城市/地区 |
| 生日 | 生日，支持备注如农历 |
| 爱吃 | 爱吃的食物 |
| 忌口 | 食物过敏/忌口 |
| 爱好 | 兴趣爱好 |
| 职业 | 职业/工作 |
| 重要节日 | 重要的纪念日/节日 |
| 恐惧/弱点 | 害怕/讨厌的东西 |
| 作息规律 | 作息时间规律 |
| 技能水平 | 会什么技能 |
| 健康状况 | 健康状况/注意事项 |
| 宠物 | 宠物信息 |
| 备注 | AI的自由备注，自动追加保留最近N条 |

> 字段列表可在配置中自定义增删

## 用户指令

| 指令 | 说明 | 示例 |
|------|------|------|
| `我的画像` | 查看自己的画像信息 | `我的画像` |
| `删除画像 <字段/编号>` | 删除指定字段或备注条目 | `删除画像 生日` 或 `删除画像 1` |
| `清空画像` | 清空所有个人画像数据 | `清空画像` |

## 管理员指令

| 指令 | 说明 | 示例 |
|------|------|------|
| `查询画像 <用户ID>` | 查询指定用户的画像 | `查询画像 12345` |
| `画像统计` | 显示画像系统统计信息（不显示具体内容） | `画像统计` |

## AI自动标记

### 记录/更新画像
AI在识别到用户信息时，会在回复末尾添加标签：
```
[Profile: 对用户的称呼=小明, 性别=男]
[Profile: 生日=腊月初八(农历)]
[Profile: 爱吃=火锅、奶茶]
```

### 删除画像
删除备注条目（按编号，支持多个）：
```
[ProfileDelete: 1]
[ProfileDelete: 1, 2]
```

删除整个字段：
```
[ProfileDelete: 生日]
```

> 这些标签会被自动清理，用户不会看到。

## 配置项

在AstrBot管理面板中可配置：

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| session_based | 画像按窗口独立存储 | false（全局共享） |
| allowed_fields | 允许记录的字段列表 | 见上方默认字段 |
| max_notes_count | 备注保留条数 | 5 |
| allow_profile_in_group | 允许在群聊中查看画像 | false |
| group_profile_denied_msg | 群聊查看画像被拒绝时的提示 | 画像内容可能涉及隐私，请在私聊查看 |
| admin_permission_denied_msg | 管理员命令权限不足提示 | 错误：此命令仅限管理员使用。 |
| profile_prompt | 画像系统提示词模板 | （内置模板） |
| debug_log_level | 日志级别 | INFO |

### 提示词模板变量

`profile_prompt` 支持以下变量：
- `{profile_summary}` - 当前用户画像摘要
- `{allowed_fields_display}` - 可用字段列表
- `{max_notes_count}` - 备注保留条数

## 数据存储

插件数据存储在 `data/plugin_data/astrbot_plugin_soulmap/` 目录下：
- `user_profiles.json` - 所有用户画像数据

## 作者

柯尔
