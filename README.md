# 用户画像

AI驱动的用户画像收集系统，在聊天中自动提取用户信息，支持模板约束。

## 功能特点

- **无感收集**：AI在聊天中自然提取用户信息，无需用户手动填写
- **模板约束**：只能记录预定义字段，AI无法随意新增字段
- **用户可控**：用户可随时查看/删除自己的数据
- **农历生日支持**：生日字段支持备注，如 `03-15(农历)`

## 支持的画像字段

| 字段 | 说明 | 类型 |
|-----|------|-----|
| `昵称` | 用户希望被叫的名字/昵称 | 字符串 |
| `性别` | 性别 | 字符串 |
| `年龄` | 年龄 | 字符串 |
| `所在地` | 所在城市/地区 | 字符串 |
| `生日` | 生日，支持备注如农历 | 字符串 |
| `爱吃` | 爱吃的食物 | 字符串 |
| `忌口` | 食物过敏/忌口 | 字符串 |
| `爱好` | 兴趣爱好 | 字符串 |
| `职业` | 职业/工作 | 字符串 |
| `重要节日` | 重要的纪念日/节日 | 字符串 |
| `恐惧/弱点` | 害怕/讨厌的东西 | 字符串 |
| `作息规律` | 作息时间规律 | 字符串 |
| `技能水平` | 会什么技能 | 字符串 |
| `健康状况` | 健康状况/注意事项 | 字符串 |
| `宠物` | 宠物信息 | 字符串 |
| `备注` | AI的自由备注（近期事件） | 字符串 |

## 用户指令

| 指令 | 说明 |
|-----|------|
| `我的画像` | 查看自己的画像信息 |
| `删除画像 <字段>` | 删除指定字段，如 `删除画像 生日` |
| `清空画像` | 清空所有个人画像数据 |

## 管理员指令

| 指令 | 说明 |
|-----|------|
| `查询画像 <用户ID>` | 查询指定用户的画像 |
| `导出画像` | 导出所有用户画像统计 |
| `画像统计` | 显示画像系统统计信息 |

## 配置项

在 AstrBot 后台配置：

- **session_based**：是否按会话独立存储（默认关闭，全局统一）
- **allowed_fields**：允许记录的字段列表
- **max_notes_count**：备注保留条数（默认5）
- **admin_permission_denied_msg**：管理员命令权限不足提示
- **profile_prompt**：画像系统提示词模板（支持变量）
- **debug_log_level**：日志级别

## AI输出格式

AI在识别到用户信息时，会在回复末尾添加标签：

```
[Profile: 昵称=小明, 性别=男]
[Profile: 生日=腊月初八(农历)]
[Profile: 忌口=海鲜、花生]
```

删除备注条目（按编号）：
```
[ProfileDelete: 1]
[ProfileDelete: 1, 2]
```

删除整个字段：
```
[ProfileDelete: 生日]
```

这些标签会被自动清理，用户不会看到。

## 数据存储

画像数据存储在插件数据目录的 `user_profiles.json` 文件中。

## 作者

柯尔
